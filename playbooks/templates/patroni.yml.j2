scope: "{{ cluster_name }}"
namespace: "/service/"
name: "{{ inventory_hostname }}"

restapi:
  listen: "{{ ansible_default_ipv4.address }}:8008"
  connect_address: "{{ ansible_default_ipv4.address }}:8008"

etcd:
  hosts: "{{ etcd_url }}"

bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    maximum_lag_on_failover: 1048576
    postgresql:
      use_pg_rewind: true
      use_slots: true
  initdb:
    - encoding: UTF8
    - locale: en_US.UTF-8
  users:
    "{{ postgresql_admin_user }}":
      password: "{{ postgresql_admin_password }}"
      options:
        - superuser
        - createdb
    "{{ replication_user }}":
      password: "{{ replication_password }}"
      options:
        - replication

postgresql:
  listen: "{{ ansible_default_ipv4.address }}:5432"
  connect_address: "{{ ansible_default_ipv4.address }}:5432"
  data_dir: "{{ pg_data_dir }}"
  bin_dir: "/usr/lib/postgresql/14/bin"
  config_dir: "/etc/postgresql/14/main"
  pgpass: "/tmp/pgpass"
  authentication:
    replication:
      username: "{{ replication_user }}"
      password: "{{ replication_password }}"
    superuser:
      username: "{{ postgresql_admin_user }}"
      password: "{{ postgresql_admin_password }}"
  parameters:
    wal_level: replica
    hot_standby: "on"
    max_wal_senders: 10
    max_replication_slots: 10
    wal_keep_size: 512MB
